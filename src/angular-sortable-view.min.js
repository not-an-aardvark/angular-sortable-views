/*
	Copyright Kamil PÄ™kala http://github.com/kamilkp
	angular-sortable-view v0.0.13 2015/01/13
*/
!function(a,b){"use strict";function c(a){if(!("clientX"in a||"clientY"in a)){var b=a.touches||a.originalEvent.touches;b&&b.length&&(a.clientX=b[0].clientX,a.clientY=b[0].clientY),a.preventDefault()}}function d(a){if(a=a[0],a.previousElementSibling)return b.element(a.previousElementSibling);for(var c=a.previousSibling;null!=c&&1!=c.nodeType;)c=c.previousSibling;return b.element(c)}function e(a,b){var c=d(a);c.length>0?c.after(b):a.parent().prepend(b)}function f(a,c){if(a instanceof b.element&&(a=a[0]),null!==i)return a[i](c)}var g=b.module("angular-sortable-view",[]);g.directive("svRoot",[function(){function b(a,b,c){return c?a.x-b.x<0:a.y-b.y<0}function c(a){return h[a]}function d(a){delete h[a]}var g,h=Object.create(null);return a.ROOTS_MAP=h,{restrict:"A",controller:["$scope","$attrs","$interpolate","$parse",function(a,i,j,k){var l=j(i.svRoot)(a)||a.$id;h[l]||(h[l]=[]);var m,n,o,p,q,r,s=this,t=!1,u=!1,v=k(i.svOnSort);a.$watch(k(i.svDisabled),function(a,b){u=a}),i.svOnStart=i.$$element[0].attributes["sv-on-start"],i.svOnStart=i.svOnStart&&i.svOnStart.value,i.svOnStop=i.$$element[0].attributes["sv-on-stop"],i.svOnStop=i.svOnStop&&i.svOnStop.value;var w=k(i.svOnStart),x=k(i.svOnStop);if(this.mapKey=l,this.sortingInProgress=function(){return g},this.sortingDisabled=function(){return u},i.svGrid){if(t="true"===i.svGrid||"false"!==i.svGrid&&null,null===t)throw"Invalid value of sv-grid attribute"}else a.$watchCollection(function(){return c(l)},function(a){t=!1;var b=a.filter(function(a){return!a.container}).map(function(a){return{part:a.getPart().id,y:a.element[0].getBoundingClientRect().top}}),c=Object.create(null);b.forEach(function(a){c[a.part]?c[a.part].push(a.y):c[a.part]=[a.y]}),Object.keys(c).forEach(function(a){c[a].sort(),c[a].forEach(function(b,d){d<c[a].length-1&&b>0&&b===c[a][d+1]&&(t=!0)})})});this.$moveUpdate=function(d,h,i,j,k,s,u){var v=i[0].getBoundingClientRect();"element"===d.tolerance&&(h={x:~~(v.left+v.width/2),y:~~(v.top+v.height/2)}),g=!0,m=[],n||(k?(n=k.clone(),n.removeClass("ng-hide")):(n=j.clone(),n.addClass("sv-visibility-hidden"),n.addClass("sv-placeholder"),n.css({height:v.height+"px",width:v.width+"px"})),j.after(n),j.addClass("ng-hide"),q=j,o=d,p=i,w(a,{$helper:{element:p},$part:s.model(s.scope),$index:u,$item:s.model(s.scope)[u]}),a.$root&&a.$root.$$phase||a.$apply()),p[0].style.position="fixed",p[0].reposition({x:h.x+document.body.scrollLeft-h.offset.x*v.width,y:h.y+document.body.scrollTop-h.offset.y*v.height}),c(l).forEach(function(a,c){if(null==d.containment||f(a.element,d.containment)||f(a.element,d.containment+" *")){var e=a.element[0].getBoundingClientRect(),g={x:~~(e.left+e.width/2),y:~~(e.top+e.height/2)};a.container||!a.element[0].scrollHeight&&!a.element[0].scrollWidth||m.push({element:a.element,q:(g.x-h.x)*(g.x-h.x)+(g.y-h.y)*(g.y-h.y),view:a.getPart(),targetIndex:a.getIndex(),after:b(g,h,t)}),a.container&&!a.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")&&m.push({element:a.element,q:(g.x-h.x)*(g.x-h.x)+(g.y-h.y)*(g.y-h.y),view:a.getPart(),targetIndex:0,container:!0})}});var x=n[0].getBoundingClientRect(),y={x:~~(x.left+x.width/2),y:~~(x.top+x.height/2)};m.push({q:(y.x-h.x)*(y.x-h.x)+(y.y-h.y)*(y.y-h.y),element:n,placeholder:!0}),m.sort(function(a,b){return a.q-b.q}),m.forEach(function(a,b){0!==b||a.placeholder||a.container?0===b&&a.container?(r=a,a.element.append(n)):a.element.removeClass("sv-candidate"):(r=a,a.element.addClass("sv-candidate"),a.after?a.element.after(n):e(a.element,n))})},this.$drop=function(b,c,d){function e(){if(g=!1,n.remove(),p.remove(),q.removeClass("ng-hide"),m=void 0,n=void 0,d=void 0,p=void 0,q=void 0,x(a,{$part:b.model(b.scope),$index:c,$item:b.model(b.scope)[c]}),r){r.element.removeClass("sv-candidate");var e=[b.model(b.scope)[c]];s.keepInList||(e=b.model(b.scope).splice(c,1));var f=r.targetIndex;if(r.view===b&&r.targetIndex>c&&f--,r.after&&f++,r.view.model(r.view.scope).splice(f,0,e[0]),r.view!==b||c!==f){var h=v,i=a;if(r.view.element&&r.view.element.attr("sv-on-sort")){var i=r.view.element.scope(),j=k(r.view.element.attr("sv-on-sort"));j&&(h=j)}h(i,{$partTo:r.view.model(r.view.scope),$partFrom:b.model(b.scope),$item:e[0],$indexTo:f,$indexFrom:c});var l=r.view.element;l.addClass("sv-dropped"),setTimeout(function(){l.removeClass("sv-dropped"),l=void 0},300)}}r=void 0,a.$root&&a.$root.$$phase||a.$apply()}if(n)if(d.revert){var f=n[0].getBoundingClientRect(),h=p[0].getBoundingClientRect(),i=Math.sqrt(Math.pow(h.top-f.top,2)+Math.pow(h.left-f.left,2)),j=+d.revert*i/200;j=Math.min(j,+d.revert),["-webkit-","-moz-","-ms-","-o-",""].forEach(function(a){"undefined"!=typeof p[0].style[a+"transition"]&&(p[0].style[a+"transition"]="all "+j+"ms ease")}),setTimeout(e,j),p.css({top:f.top+document.body.scrollTop+"px",left:f.left+document.body.scrollLeft+"px"})}else e()},this.addToSortableElements=function(a){c(l).push(a)},this.removeFromSortableElements=function(a){var b=c(l),e=b.indexOf(a);e>-1&&(b.splice(e,1),0===b.length&&d(l))}}]}}]),g.directive("svPart",["$parse",function(a){return{restrict:"A",require:"^svRoot",controller:["$scope",function(a){a.$ctrl=this,this.getPart=function(){return a.part},this.$drop=function(b,c){a.$sortableRoot.$drop(a.part,b,c)}}],scope:!0,link:function(b,c,d,e){if(!d.svPart)throw new Error("no model provided");var f=a(d.svPart);if(!f.assign)throw new Error("model not assignable");e.keepInList=a(d.svKeepInList)(b),b.$ctrl.isDropzone=a(d.svIsDropzone)(b)!==!1,b.part={id:b.$id,element:c,model:f,scope:b},b.$sortableRoot=e;var g={element:c,getPart:b.$ctrl.getPart,container:!0};b.$ctrl.isDropzone&&e.addToSortableElements(g),b.$on("$destroy",function(){e.removeFromSortableElements(g)})}}}]),g.directive("svElement",["$parse",function(a){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(a){a.$ctrl=this}],link:function(d,e,f,g){function h(a){return a?(l.off("mousedown touchstart",i),l=a,void l.on("mousedown touchstart",i)):void l.off("mousedown touchstart",i)}function i(h){function i(a){c(a),o||(e.parent().prepend(q),o=!0),g[1].$moveUpdate(k,{x:a.clientX,y:a.clientY,offset:t},q,e,n,g[0].getPart(),d.$index)}if(!(g[1].sortingInProgress()||g[1].sortingDisabled()||0!=h.button&&"mousedown"===h.type)){c(h),o=!1;var k=a(f.svElement)(d);if(k=b.extend({},{tolerance:"pointer",revert:200,containment:"html"},k),k.containment)var l=j.call(e,k.containment)[0].getBoundingClientRect();var q,r=e,s=e[0].getBoundingClientRect();m||(m=g[0].helper),n||(n=g[0].placeholder),m?(q=m.clone(),q.removeClass("ng-hide"),q.css({left:s.left+document.body.scrollLeft+"px",top:s.top+document.body.scrollTop+"px"}),r.addClass("sv-visibility-hidden")):(r.addClass("sv-long-pressing"),q=r.clone(),q.addClass("sv-helper").css({left:s.left+document.body.scrollLeft+"px",top:s.top+document.body.scrollTop+"px",width:s.width+"px"})),q[0].reposition=function(a){var b=a.x,c=a.y,d=q[0].getBoundingClientRect(),e=document.body;l&&(c<l.top+e.scrollTop&&(c=l.top+e.scrollTop),c+d.height>l.top+e.scrollTop+l.height&&(c=l.top+e.scrollTop+l.height-d.height),b<l.left+e.scrollLeft&&(b=l.left+e.scrollLeft),b+d.width>l.left+e.scrollLeft+l.width&&(b=l.left+e.scrollLeft+l.width-d.width)),this.style.left=b-e.scrollLeft+"px",this.style.top=c-e.scrollTop+"px"};var t={x:(h.clientX-s.left)/s.width,y:(h.clientY-s.top)/s.height};p.addClass("sv-sorting-in-progress");var u="sv-sorting-"+g[1].mapKey;p.addClass(u),p.on("mousemove touchmove",i).on("mouseup touchend touchcancel",function a(b){p.off("mousemove touchmove",i),p.off("mouseup touchend",a),setTimeout(function(){p.removeClass("sv-sorting-in-progress"),p.removeClass(u)},500),o&&g[0].$drop(d.$index,k),e.removeClass("sv-visibility-hidden"),r.removeClass("sv-long-pressing")})}}var k={element:e,getPart:g[0].getPart,getIndex:function(){return d.$index}};g[0].isDropzone&&g[1].addToSortableElements(k),d.$on("$destroy",function(){g[1].removeFromSortableElements(k)}),d.$watch(a(f.svElementDisabled),function(a,b){h(a?!1:e)});var l=e;l.on("mousedown touchstart",i),d.$watch("$ctrl.handle",function(a){a&&h(a)});var m;d.$watch("$ctrl.helper",function(a){a&&(m=a)});var n;d.$watch("$ctrl.placeholder",function(a){a&&(n=a)});var o,p=(b.element(document.body),b.element(document.documentElement))}}}]),g.directive("svHandle",function(){return{require:"?^svElement",link:function(a,b,c,d){d&&(d.handle=b.add(d.handle))}}}),g.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function(a,b,c,d){b.addClass("sv-helper").addClass("ng-hide"),d[1]?d[1].helper=b:d[0]&&(d[0].helper=b)}}}),g.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function(a,b,c,d){if(b.addClass("sv-placeholder").addClass("ng-hide"),d[1]&&d[0])for(var e=b.parent();e.length>0;){if(e[0].hasAttribute("sv-element"))return void(d[1].placeholder=b);if(e[0].hasAttribute("sv-part"))return void(d[0].placeholder=b);e=e.parent()}else d[1]?d[1].placeholder=b:d[0]&&(d[0].placeholder=b)}}}),b.element(document.head).append(["<style>.sv-helper{position: fixed !important;z-index: 99999;margin: 0 !important;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}</style>"].join(""));var h=document.documentElement,i=h.matches?"matches":h.matchesSelector?"matchesSelector":h.webkitMatches?"webkitMatches":h.webkitMatchesSelector?"webkitMatchesSelector":h.msMatches?"msMatches":h.msMatchesSelector?"msMatchesSelector":h.mozMatches?"mozMatches":h.mozMatchesSelector?"mozMatchesSelector":null;if(null==i)throw"This browser doesn't support the HTMLElement.matches method";var j=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&!c[i](a);)c=c.parentNode;return c[i](a)?b.element(c):b.element()};"function"!=typeof b.element.prototype.add&&(b.element.prototype.add=function(a){var c,d=b.element();for(a=b.element(a),c=0;c<this.length;c++)d.push(this[c]);for(c=0;c<a.length;c++)d.push(a[c]);return d})}(window,window.angular);